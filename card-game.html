<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./card-game.css"/>
</head>
<body>
    <button id="gameStartButton" onclick="startGame()">CREATE</button>
	<div id="out"></div>   

    <script src="./card-game.js"></script>
    <script>
// defines game table where cards are placed
let gameTable = document.getElementById('out');

// defines player health
let playerHealth = 3;

// defines the computer health
let computerHealth;

// defines the 'back' of the card
let cardBack = './media/pictures/arcana-cards/back.png';

// defines main array with all cards
const gameCards = [
    {
        name: 'devil',
        image: './media/pictures/arcana-cards/devil.png'
    },
    {
        name: 'emperor',
        image: './media/pictures/arcana-cards/emperor.png'
    },
    {
        name: 'judgement',
        image: './media/pictures/arcana-cards/judgement.png'
    },
    {
        name: 'magician',
        image: './media/pictures/arcana-cards/magician.png'
    },
    {
        name: 'star',
        image: './media/pictures/arcana-cards/star.png'
    },
    {
        name: 'tower',
        image: './media/pictures/arcana-cards/tower.png'
    },    
]

// function to start game
function startGame(){

    // dublicates array so the cards would have pairs
    gameCards.push(...gameCards);
    console.log('cards are: ', gameCards);

    // sets the computer health, which is unique card amount
    computerHealth = gameCards.length/2;

    // starts function to shuffle dublicated array
    shuffleArray(gameCards);
    // starts function to create the table with cards
    createGameField(gameCards);

    // starts function to pick the first card
    setTimeout(hideCards, 3000);
}

//  Fisher-Yates Algorithm to shuffle the deck
function shuffleArray(deck){
    for(let i = deck.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * i)
        const temp = deck[i];
        deck[i] = deck[j];
        deck[j] = temp;
    }
    // console.log('shuffled array is: ', deck);
}

// function to create the game field. By default it is 3 rows x 4 columns (possibly will make difficulties later)
function createGameField (gameCards){
    // general array with game field
    const gameField = new Array();

    let arrayRows = 3;
    let arrayColumns = 4;

    // create arrays in array
    for (let i=0; i<arrayRows; i++){
        gameField[i] = new Array();
    }
    // the index number for array with cards
    let a = 0;

        // filling rows
        for (let i=0; i<arrayRows; i++){
            // filling columns
            for (let j=0; j<arrayColumns; j++){
                    gameField[i][j] = gameCards[a];
                    a++;
            }
        }
    // function that 
    createTable(gameField);
}

function createTable(gameField){
    // creatres html table
    let html = "<table border='2' cellpadding='20'>";
        for (i=0; i<gameField.length; i++)
        {
            html += "<tr>";
            for(j=0; j<gameField[i].length; j++)
            {
                html += `<td> <img class="${gameField[i][j].name} card" src=${gameField[i][j].image} height="150"> </td>`;
            }
            html += "</tr>";
        }
        html += "</table>";

        //html element is pushed in div with id - #out
        gameTable.innerHTML = html;
}

function hideCards(){
    // creates an array from all table elements
    const cardToChose = document.querySelectorAll('.card');

    // method to hide all cards
    cardToChose.forEach(function (element){
        // changes picture to 'back' of the card
        element.src = cardBack;
        // adds class to all cards, it will be needed later to make a check if the card is 'faced'
        element.classList.add('hidden');
        // console.log(element)
    })

    // function to chose the first card
    pickCardOne(cardToChose);
}


// function to pick the first card
function pickCardOne(cardToChose){

    // for each table element creates event listener
    cardToChose.forEach(function (chosenCard){
            chosenCard.addEventListener('click', cardOne);
    })

    // works with the chosen card
    function cardOne(element){
        // this conditional allows to choose only cards that are are hidden
        if (element.target.classList.contains('hidden')){
            element.target.classList.remove('hidden');
            // defines the choice that user made
            let cardOneChoice = element.target;
            // paints the chosen card 'black'
            cardOneChoice.style.background = 'black';

            // checkes the array with all cards and takes the needed src
            cardOneChoice.src = gameCards.find(function (e){
                return e.name === cardOneChoice.classList.item(0);
            }).image;
            console.log('card one choice is: ', cardOneChoice);
            // removes event listener so 'first card' can't be chosen again
            cardToChose.forEach(function (chosenCard){
                chosenCard.removeEventListener('click', cardOne);
            })
        // starts function to pich the second card
        pickCardTwo(cardToChose, cardOneChoice);            
        }
    }
}

// function to pich the second card
function pickCardTwo(cardToChose, cardOneChoice){
    // again for each table element creates event listener
    cardToChose.forEach(function (chosenCard){
        chosenCard.addEventListener('click', cardTwo);
    })

    // works with the chosen card
    function cardTwo(element){

        // doen't allow the player to choice the card chosen as first
        if (element.target == cardOneChoice){
            console.log('can`t take this one');
        } else {
            // checks if the card is hidden
            if (element.target.classList.contains('hidden')){
            element.target.classList.remove('hidden');
                // if the card is not the same as the first one defines second card
                let cardTwoChoice = element.target;
                // paints it yellow
                cardTwoChoice.style.background = 'yellow';
                // checkes the array with all cards and takes the needed src                
                cardTwoChoice.src = gameCards.find(function (e){
                    return e.name === cardTwoChoice.classList.item(0);
                }).image;

                console.log('card two choice is: ', cardTwoChoice);
                // removes possibilty to click on cards
                cardToChose.forEach(function (chosenCard){
                    chosenCard.removeEventListener('click', cardTwo);
                })

                // starts function to compare card one and card two
                compare(cardOneChoice, cardTwoChoice, cardToChose);
            }
        }
    }
}

// function to compare cards
function compare (one, two, cardToChose){
    // if the cards have the same class, that is whether the cards with similar picture
    if (one.className == two.className){
        console.log('same cards');
        // lowers computer health
        computerHealth--;
        console.log('computer health is: ', computerHealth);
        if (computerHealth == 0){
            alert('you won');
        }
        // restars the possibilty to choose the first card in a turn
        pickCardOne(cardToChose);
    } else {
        // if the cards are not simiral
        setTimeout(function () {
            console.log('wrong cards')
            playerHealth--;
            if (playerHealth == 0){
                alert('you lost');
            }
            one.style.background = 'none';
            two.style.background = 'none';
            one.classList.add('hidden');
            two.classList.add('hidden');
            one.src = cardBack;
            two.src = cardBack;
            pickCardOne(cardToChose);         
        }, 1500);

        console.log('player health is: ', playerHealth);
    }
}

    </script>
</body>
</html>